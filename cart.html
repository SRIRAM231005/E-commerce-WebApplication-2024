<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!--Header-->
    <div id="parent">
        <div class="logo"><img src="logo web.png" alt="Comp"></div>
    </div> 
    
    <!--Products Display-->
    <div class="cartBox">
      <div class="box">
        <h3 style="color: white;display: flex;font-size: 22px;font-weight: lighter;">Review Your Order | Total Items(<div id="number" style="color:#f19b1a;"></div>) </h3>   
        <div id="cartItems"></div>
        <div class="empty" style="display: flex; align-items: center; justify-content: center;">
            <div style="display: block; text-align: center;">
                <img src="empty-cart.png" style="height: 200px; width: 300px;">
                <p style="color:#ee842e;; font-size: 22px;">Your Cart is Empty!</p>
            </div>
        </div>
        <button onclick="resetCart()" class="reset">Reset Cart</button>
      </div>

      <!--Price Display-->
      <div id="total-price"></div>
    </div>  

    <script>
        // Reset 
        function resetCart() {
            localStorage.removeItem("Cart");
            localStorage.removeItem("count");
            location.reload(); // Reload the page to reflect changes
        }
        //Display Products Added to Cart
        document.addEventListener("DOMContentLoaded", function() {
            let cart =  JSON.parse(localStorage.getItem("Cart")) || [];
            const cartItemsDiv = document.getElementById("cartItems");
            const totalPriceDiv = document.getElementById("total-price");
            const number = document.getElementById("number");

            let totalPrice = 0;
            cart.forEach(item => {
                const itemLi = document.createElement("div");
                const itemDetails = document.createElement("div");
                itemDetails.className = "newCartItem";
                itemDetails.innerHTML = `<div>
                                            <img src="${item.proImage}" class="itemimg">
                                        </div> 
                                         <div class="itemDetails">
                                            <p id="name">${item.proName}</p> 
                                            <p id="price"> ₹${item.proPrice}</p> 
                                            <div class="quanta"><div class="but">Quantity: ${item.proQuantity} </div><button class="button">Update</button> <button class="delete">Delete</button></div>
                                         </div>`;
                itemLi.appendChild(itemDetails);
                cartItemsDiv.appendChild(itemLi);
                let withoutComma = item.proPrice.replace(',','');
                totalPrice += parseInt(withoutComma)*item.proQuantity; //1
                document.querySelector('.empty').style.display = 'none';

                    //Update Quantity
                    document.querySelectorAll('.button').forEach((buton)=>{
                        buton.addEventListener('click', ()=>{
                            let boy;

                            const df = buton.parentElement;
                            const hi =  df.querySelector('.but');
                            hi.innerHTML = `Quantity: <select class="sel">
                                                            <option value="1">1</option>
                                                            <option value="2">2</option>
                                                            <option value="3">3</option>
                                                            <option value="4">4</option>
                                                            <option value="5">5</option>
                                                            <option value="6">6</option>
                                                            <option value="7">7</option>
                                                            <option value="8">8</option>
                                                            <option value="9">9</option>
                                                        </select>
                                                        <button id="save">Save</button>`
                            const sel = document.querySelector('.sel');                                                                                                                                                                             
                            sel.addEventListener('change', ()=>{
                                item.proQuantity = document.querySelector('.sel').value;
                                
                            });
                            const savee = document.querySelector('#save'); 
                            savee.addEventListener('click', ()=>{
                                hi.innerHTML = `Quantity: ${item.proQuantity}`
                                update(); // Function to Display Updated Prices
                                console.log(totalPrice);   
                            });                                                                
                                                                                                                                
                    });
                    });
                

            });
            function update(){
                totalPrice = 0;
                cart.forEach(item => {
                    let withoutComma = item.proPrice.replace(',', '');
                    totalPrice += parseInt(withoutComma) * item.proQuantity;
                });
                console.log(totalPrice); // Log totalPrice after updating
                totalPriceDiv.innerHTML = `<div class="order">Order Summary</div> 
                                           <div style="margine-top: 60px;">Total Price : <div id="price1">₹${totalPrice}</div></div>
                                           <div>Shipping & Handling : <div id="price1">₹0</div></div>
                                           <div style="border-bottom: 1px solid rgb(153, 152, 152);">After GST (10%) : <div id="price1">₹${(totalPrice * 0.1) + totalPrice}</div></div>
                                           <div style="color:#dd3030; font-size: 20px; font-weight: bold;">SubTotal : <div id="price1" style="font-size: 20px; font-weight: bold;">₹${((((parseInt((totalPrice*0.1) + totalPrice))/1000).toFixed(3)).toString()).replace('.',',')}</div></div>
                                           <center><button>Place Order</button></center>
                                           <center><div class="secure">
                                            <img src="shieldTick.png">
                                            <p style="color:#878787; font-size: 13px;">
                                                Safe and Secure Payments.Easy returns.100% Authentic products.
                                            </p>
                                           </div></center>`;
            };
            number.textContent = ` ${cart.length} `;
            totalPriceDiv.innerHTML = `<div class="order">Order Summary</div> 
                                       <div style="margine-top: 60px;">Total Price : <div id="price1">₹${totalPrice}</div></div>
                                       <div>Shipping & Handling : <div id="price1">₹0</div></div>
                                       <div style="border-bottom: 1px solid rgb(153, 152, 152);">After GST (10%) : <div id="price1">₹${(totalPrice * 0.1) + totalPrice}</div></div>
                                       <div style="color:#dd3030; font-size: 20px; font-weight: bold;">SubTotal : <div id="price1" style="font-size: 20px; font-weight: bold;">₹${((((parseInt((totalPrice*0.1) + totalPrice))/1000).toFixed(3)).toString()).replace('.',',')}</div></div>
                                       <center><button>Place Order</button></center>
                                       <center><div class="secure">
                                        <img src="shieldTick.png">
                                        <p style="color:#878787; font-size: 13px;">
                                            Safe and Secure Payments.Easy returns.100% Authentic products.
                                        </p>
                                       </div></center>`;
        });
    </script>
</body>
</html>